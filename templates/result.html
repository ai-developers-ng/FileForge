{% extends 'base.html' %}

{% block title %}Result - {{ job.filename }} | FileForge{% endblock %}
{% block meta_description %}View your conversion result for {{ job.filename }}. Download your processed file.{% endblock %}

{% block content %}
<div class="page">
    <header class="hero-header">
        <h1>{{ job.filename }}</h1>
        <p>Job status: <strong>{{ job.status }}</strong></p>
    </header>

    <div class="converter-card">
        <div class="results-header">
            <div>
                <h2>Result Details</h2>
                <p>Job ID: {{ job.id }}</p>
            </div>
            <span class="status-pill">
                <span class="status-dot"></span>
                {{ job.status }}
            </span>
        </div>

        <div class="result-preview" style="margin-top: 24px;">
            <div class="result-meta">
                <span>{{ job.filename }}</span>
                {% if job.error %}
                <span class="meta-chip" style="background: rgba(239, 68, 68, 0.1); color: #dc2626;">Error</span>
                {% elif job.status == "completed" %}
                <span class="meta-chip" style="background: rgba(34, 197, 94, 0.1); color: #16a34a;">Completed</span>
                {% elif job.status == "processing" %}
                <span class="meta-chip" style="background: rgba(99, 102, 241, 0.1); color: #6366f1;">Processing</span>
                {% else %}
                <span class="meta-chip">{{ job.status }}</span>
                {% endif %}
            </div>

            {% if job.error %}
            <div class="alert alert-error" style="margin-top: 16px;">
                {{ job.error }}
            </div>
            {% else %}
            <textarea class="result-textarea" readonly>Your file has been processed. Use the download button below to get your result.</textarea>
            {% endif %}
        </div>

        <div class="result-actions">
            <a class="ghost btn" href="{{ url_for('index') }}">Back to Home</a>
            {% if job.status == "completed" %}
                {% set job_type = job.options.get('job_type', 'ocr') %}
                {% set base = job.filename.rsplit('.', 1)[0] if '.' in job.filename else job.filename %}

                {% if job_type == 'image' %}
                    {% set output_format = job.options.get('output_format', 'png') %}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/image?token={{ token }}" data-filename="{{ base }}_converted.{{ output_format }}">Download {{ output_format.upper() }}</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}.json">Download JSON (Metadata)</a>

                {% elif job_type == 'document' %}
                    {% set output_format = job.options.get('output_format', 'pdf') %}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/document?token={{ token }}" data-filename="{{ base }}_converted.{{ output_format }}">Download {{ output_format.upper() }}</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}.json">Download JSON (Metadata)</a>

                {% elif job_type == 'audio' %}
                    {% set output_format = job.options.get('output_format', 'mp3') %}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/audio?token={{ token }}" data-filename="{{ base }}_converted.{{ output_format }}">Download {{ output_format.upper() }}</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}.json">Download JSON (Metadata)</a>

                {% elif job_type == 'video' %}
                    {% set output_format = job.options.get('output_format', 'mp4') %}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/video?token={{ token }}" data-filename="{{ base }}_converted.{{ output_format }}">Download {{ output_format.upper() }}</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}.json">Download JSON (Metadata)</a>

                {% elif job_type == 'pdf' %}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/pdf?token={{ token }}" data-filename="{{ base }}_result.pdf">Download PDF</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}.json">Download JSON (Metadata)</a>

                {% else %}
                    {# OCR job - show TXT, JSON, PDF #}
                    <a class="primary btn" href="/api/jobs/{{ job.id }}/download/txt?token={{ token }}" data-filename="{{ base }}_OCR.txt">Download TXT</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/json?token={{ token }}" data-filename="{{ base }}_OCR.json">Download JSON</a>
                    <a class="ghost btn" href="/api/jobs/{{ job.id }}/download/pdf?token={{ token }}" data-filename="{{ base }}_OCR.pdf">Download PDF</a>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
